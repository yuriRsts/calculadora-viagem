<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora de Viagem</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4a90e2">

<style>
*{box-sizing:border-box;font-family:Arial,sans-serif}
body{
  margin:0;
  min-height:100vh;
  background:#1e1e1e;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding:20px;
  color:#fff;
}
.container{
  width:100%;
  max-width:420px;
  background:#2a2a2a;
  padding:20px;
  border-radius:12px;
}
h2{text-align:center;margin-bottom:15px}
input,button{
  width:100%;
  height:46px;
  margin-bottom:10px;
  border-radius:8px;
  border:1px solid #444;
  background:#1f1f1f;
  color:#fff;
  padding:0 12px;
}
button{
  background:#4a90e2;
  font-weight:bold;
  cursor:pointer;
}
button:hover{opacity:.9}
#resultado{
  background:#1f1f1f;
  padding:12px;
  border-radius:8px;
  margin-top:10px;
}
#map{
  width:100%;
  height:220px;
  margin-top:10px;
  border-radius:8px;
  overflow:hidden;
}
.autocomplete-list{
  position:absolute;
  background:#1f1f1f;
  border:1px solid #444;
  border-radius:6px;
  z-index:9999;
}
.autocomplete-item{
  padding:8px;
  cursor:pointer;
  color:#fff;
}
.autocomplete-item:hover{background:#333}
</style>
</head>

<body>
<div class="container">
<h2>Calculadora de Viagem</h2>

<input id="origem" placeholder="Endere√ßo de origem">
<input id="destino" placeholder="Endere√ßo de destino">
<input id="kmLitro" type="number" placeholder="Km por litro">
<input id="precoGas" type="number" placeholder="Pre√ßo da gasolina">
<input id="pedagioManual" type="number" placeholder="Ped√°gio informado (opcional)">

<button onclick="calcular()">Calcular</button>

<div id="resultado"></div>

<button id="btnMaps" style="display:none" onclick="abrirMaps()">Abrir no Google Maps</button>
<button id="btnWaze" style="display:none" onclick="abrirWaze()">Abrir no Waze</button>

<div id="map"></div>
</div>

<script>
let map, directionsService, directionsRenderer;

function calcularPedagioAutomatico(km){
  if(km<=100) return km*0.08;
  if(km<=300) return km*0.12;
  return km*0.15;
}

function calcular(){
  const origem=document.getElementById("origem").value;
  const destino=document.getElementById("destino").value;
  const kmLitro=parseFloat(document.getElementById("kmLitro").value);
  const precoGas=parseFloat(document.getElementById("precoGas").value);
  const pedagioManual=parseFloat(document.getElementById("pedagioManual").value)||0;

  if(!origem||!destino||!kmLitro||!precoGas){
    alert("Preencha todos os campos obrigat√≥rios");
    return;
  }

  directionsService.route({
    origin:origem,
    destination:destino,
    travelMode:"DRIVING"
  },(res,status)=>{
    if(status!=="OK"){alert("Erro ao calcular rota");return;}

    directionsRenderer.setDirections(res);

    const km=res.routes[0].legs[0].distance.value/1000;
    const tempo=res.routes[0].legs[0].duration.text;

    const litros=km/kmLitro;
    const custoComb=litros*precoGas;

    const pedagioAuto=calcularPedagioAutomatico(km);
    const total=custoComb+pedagioAuto+pedagioManual;

    document.getElementById("resultado").innerHTML=`
üìç Dist√¢ncia: ${km.toFixed(2)} km<br>
‚è± Tempo estimado: ${tempo}<br>
‚õΩ Combust√≠vel: R$ ${custoComb.toFixed(2)}<br>
üõ£ Ped√°gio estimado: R$ ${pedagioAuto.toFixed(2)}<br>
‚ûï Ped√°gio informado: R$ ${pedagioManual.toFixed(2)}<br>
üí∞ <b>Total: R$ ${total.toFixed(2)}</b>
`;

    localStorage.setItem("ultimaRota",JSON.stringify({
      origem,destino,kmLitro,precoGas,pedagioManual
    }));

    document.getElementById("btnMaps").style.display="block";
    document.getElementById("btnWaze").style.display="block";
  });
}

function abrirMaps(){
  window.open(`https://www.google.com/maps/dir/${origem.value}/${destino.value}`,"_blank");
}
function abrirWaze(){
  window.open(`https://waze.com/ul?q=${destino.value}`,"_blank");
}

function initMap(){
  map=new google.maps.Map(document.getElementById("map"),{
    zoom:6,
    center:{lat:-23.55,lng:-46.63}
  });
  directionsService=new google.maps.DirectionsService();
  directionsRenderer=new google.maps.DirectionsRenderer({map});
}

window.onload=()=>{
  const ultima=JSON.parse(localStorage.getItem("ultimaRota"));
  if(ultima){
    origem.value=ultima.origem;
    destino.value=ultima.destino;
    kmLitro.value=ultima.kmLitro;
    precoGas.value=ultima.precoGas;
    pedagioManual.value=ultima.pedagioManual;
  }
}
</script>

<script async
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDiYWC1UozNM6xqegQg__CQvNA3FXgFbEA&libraries=places&callback=initMap">
</script>

<script>
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js');
}
</script>

</body>
</html>
